<%# The index view is the "body" that will be supplied to the layout. %>
    <!--Layout wireframe will be:
            - Header: NFT Minting App  Connect Wallet
            - Navigation: Home About 
            - Home:
             - Welcome message
             - Images sequentially being displayed | Features listed  
             - Mint button (trigger connect wallet "modal(w3)" if not connected)
            - About:
             - Team: Caio Sa
             - About: Project WDD330
        -->
    <%- include("partials/head") %>
        <%- include("partials/header") %>
            <%- include("partials/navigation") %>
                <div id="home" class="grid">
                    <h1 id="welcome">Welcome to RNC: Random NFT Collection</h1>
                    <div class="main-list">
                        <!--animation-->
                        <img alt="nft random images sample animation" src="/images/site/own_today.png">
                        <!--feature-->
                        <div class="features">
                            <h2>RNC Collection</h2>
                            <ul>
                                <li>Awesome RGI: Random Generated Images</li>
                                <li>Images Stored on IPFS, forever!</li>
                                <li>Mint Permissionless, for free!</li>
                            </ul>
                        </div>
                    </div>
                    <!--
        mintNFT will check whether the wallet connection has been made.
        If not, throw modal for the user to connect their wallet.
        -->
                    <button type="button" onclick="mintNFT()">MINT NOW!</button>
                </div>
                <div id="about">
                    <h2>Meet Out Team</h2>
                    <div class="team-list">
                        <img alt="project owner" src="/images/site/own_today.png">
                        <!--feature-->
                        <div class="adjectives">
                            <h2>WDD 330 Student</h2>
                            <ul>
                                <li>Brazilian</li>
                                <li>24 Years</li>
                                <li>WDD 330 Student</li>
                                <li>Blockchain enthusiast</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <%- include("partials/footer") %>
                    <script>
                        const connectWalletButton = document.querySelector("#wallet-connect")
                        connectWalletButton.addEventListener("click", connectWallet)

                        async function connectWallet() {
                            try {
                                // check the current status - if not connected, try connecting:
                                const status = await fetch("/wallet/status")
                                console.log("json", await status.json())

                                // this may fail if there are multiple wallet extensions in the browser
                                if (window.ethereum && !status.account) {
                                    const accounts = await window.ethereum.request({
                                        method: 'eth_requestAccounts'
                                    })

                                    console.log(accounts[0])

                                    // get the connected account on the server
                                    const response = await fetch("/wallet/connect", {
                                        method: 'POST',
                                        headers: {
                                            'Content-Type': 'application/json'
                                        },
                                        body: JSON.stringify({
                                            walletAddress: accounts[0]
                                        })
                                    })

                                    const result = await response.json()

                                    console.log("result ", result)

                                    // if it worked, update html
                                    if (result.success) {
                                        // update html
                                        console.log("TODO update html")
                                    }
                                }
                            } catch (err) {
                                console.error('Failed connecting wallet ' + err)
                            }
                        }


                        // const isWalletConnected = await checkWalletStatus()
                        // if (!isWalletConnected) {
                        //     const metamaskWallet = await fetch("/wallet/connect")
                        //     try {
                        //         await checkWalletStatus()
                        //     } catch (err) {
                        //         console.error(err)
                        //     }
                        // }

                        // async function checkWalletStatus() {
                        //     const response = await fetch("/wallet/status")
                        //     if (response.connected && response.account) {
                        //         const connectWalletButton = document.getElementById("connect-wallet")
                        //         connectWalletButton.innerHTML = response.account
                        //         return true
                        //     }

                        //     return false
                        // }

                    </script>